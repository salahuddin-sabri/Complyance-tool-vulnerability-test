<?php 
   
function getConnection() 
{
	 
	$dbhost = "schoolforms.cjahuqpumuov.us-east-1.rds.amazonaws.com";
	$dbname = "mzrdb";
	$dbuser = "schoolforms";
	$dbpass = "melosh123";
    $dbh = new PDO("mysql:host=$dbhost;dbname=$dbname", $dbuser, $dbpass);
  $dbh->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
  return $dbh;
}

$db =getConnection();


header('Access-Control-Allow-Origin: *');

 if(!empty($_FILES["excel_file"]))  
 { 

      $admin = $_POST['admin'];
	  $taskdate = $_POST['taskdate'];
	  $DateOfTaskCompletion = "";
      $TaskStatus	="Pending"; 
      
	  $file_array = explode(".", $_FILES["excel_file"]["name"]); 
	  
	  
		$info = pathinfo($_FILES['excel_file']['name']);
		$ext = $info['extension']; // get the extension of the file
		$newname = "todolist.".$ext; 
		$target = 'images/'.$newname;
		move_uploaded_file( $_FILES['excel_file']['tmp_name'], $target);
			
      if($file_array[1] == "xls")  
      {  
           include("PHPExcel/Classes/PHPExcel/IOFactory.php");  
           $object = PHPExcel_IOFactory::load($target);  
           foreach($object->getWorksheetIterator() as $worksheet)  
           {  
                $highestRow = $worksheet->getHighestRow();  
                for($row=2; $row<=$highestRow; $row++)  
                {  
						$Task = $worksheet->getCellByColumnAndRow(1, $row)->getValue();  
						$Priority = $worksheet->getCellByColumnAndRow(2, $row)->getValue();
											
						
			$statement= $db->prepare('INSERT INTO schoolforms.rcm_tasks_v2 (taskdate, tasktype, taskpriority, taskcompdate, admin, Status) VALUES (?,?,?,?,?,?)');
	$arr = array();
	array_push($arr,$taskdate,$Task,$Priority,$DateOfTaskCompletion,$admin,$TaskStatus);
	if($statement->execute($arr))
	{
		//echo json_encode("success");
	}
	else {
		//echo json_encode("error");
		}
						
                   
                }  
				
			
           }  
        echo json_encode(1); 
		unlink($target); 
        
      }  
      else  
      {  
          // echo '<label class="text-danger">Invalid File</label>'; 
		  echo json_encode(2); 
      }  
 }  
 ?>  